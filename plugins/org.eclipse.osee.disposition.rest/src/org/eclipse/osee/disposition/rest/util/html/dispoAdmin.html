 <?include path="4000000000000000 pageDeclaration.html" ?>
     
     <head>
         <base href="http://<?serverPort?>/dispo/init" target="_self"></base>
         <style>
             <?include path="4000000000000029 dispoAdminStyles.css"?>
         </style>
         <link rel="stylesheet" href="/lib/css/bootstrap.min.css">
        <title>Disposition Tool: Admin</title>
     </head>
 
<body onload="getPrograms();">
 	<div id="blanket" style="display:none"></div>
 		<div id="waitBlanket" style="display:none"><div id="waitText">Please Wait...</div></div>
 	<div id="setCreateDiv" style="display:none;"><h3 id="promptTitle" align="center"><h3>
 			<input class="form-control" id="setNameInput" placeholder="Set Name" type="text" value=""><br>
 			<input class="form-control" id="setPathInput" placeholder="Import Path" type="text" value=""><br>
 			<button class="form-control" id="namePromptSubmit" value="Submit">Submit</button>
 			<button class="form-control" id="cancelCreateSet" value="Cancel" onclick="namePromptClose();">Cancel</button>
 	</div>
     <div id="all">
            <div id="title">
					<h1 align="center">Disposition Tool: Admin</h1>
            </div>
         <div id="userInput">
             <div id="programSelectDiv">
 	                 <p>Select ATS Version</p>
 	                 <select class="form-control" id="programSelect" onchange="getProgramDetails(this);">
 	                        <option selected disabled>Choose one</option>
 	                 </select>
             </div>
             <div id="setControls">
             	<div id="topHalfSetControls">
 						<div id="setOperationContainer">
 	                      <button class="form-control" id="setOperation" onclick="doImport()">Import</button>
 	                      <button class="form-control" id="rename" onclick="getSetForUpdate()">Rename/Update Path</button>
 	                      <button class="form-control" id="delete" onclick="doSetDelete()">Delete Set</button>
 	                </div>
 	                <div id="setManageContainer">
 	                    <div id="createSetContainer">
 	                        <button class="form-control" disabled="true" id="setCreate" onclick="bringUpNamePromptCreate();">Create New Set</button>
 	                    </div>
 	                    <div id="setsTableContainer">
 	                        <table class="table emptySetsTable" id="setsTable">
 	                            <tbody>
 	                                <tr id="headerRow">
 	                                    <th>Name</th>
 	                                    <th>Summary</th>
 	                                </tr>
 	                            </tbody>
 	                            <tbody id="setsTableBody">
 	                                <tr>
 	                                    <td class="setsTableData"></td>
 	                                    <td class="setsTableData"></td>
 	                                </tr>
 	                                <tr>
 	                                    <td class="setsTableData"></td>
 	                                    <td class="setsTableData"></td>
 	                                </tr>
 	                                <tr>
 	                                    <td class="setsTableData"></td>
 	                                    <td class="setsTableData"></td>
 	                                </tr>
 	                                <tr>
 	                                    <td class="setsTableData"></td>
 	                                    <td class="setsTableData"></td>
 	                                </tr>
 	                                <tr>
 	                                    <td class="setsTableData"></td>
 	                                    <td class="setsTableData"></td>
 	                                </tr>
 	                                <tr>
 	                                    <td class="setsTableData"></td>
 	                                    <td class="setsTableData"></td>
 	                                </tr>
 	                                <tr>
 	                                    <td class="setsTableData"></td>
 	                                    <td class="setsTableData"></td>
 	                                </tr>
 	                            </tbody>
 	                        </table>
 	                    </div>
 	                 </div>
                 </div>
                 <div id="reportDiv">
                 	 <div id="generateReportDiv">
                 	 		<button class="form-control" id="generateReport" onclick="generateReport()">Generate Report</button>
                 	 </div>
                 	 <div id="reportSupportDiv">
 							  <p>Select Primary Set (Demo)</p>
 							  <select class="form-control" id="setSelectPrimary">
 							    <option selected disabled>Choose one</option>
 							  </select>
 							    <p>Select Secondary Set (Dry Run)</p>
 							  <select class="form-control" id="setSelectSecondary">
 							    <option selected disabled>Choose one</option>
 							  </select>
 						  </div>
                  </div>
             </div>
         </div>
     </div>
     <script>
     	 var namePromptSumbit = document.getElementById("namePromptSubmit");
        var programSelect = document.getElementById("programSelect");
        var setSelectPrimary = document.getElementById("setSelectPrimary");
        var setSelectSecondary = document.getElementById("setSelectSecondary");
     	 var createSetDiv = document.getElementById("setCreateDiv");
        var waitBlanket = document.getElementById("waitBlanket");
        var lastFocusedSet = "";
        var path = "http://<?serverPort?>/dispo/program/";
        var path2 = "http://<?serverPort?>/dispo/";
     </script> 
    <script>
     	 function setFocused(element) {
 			 if(lastFocusedSet == "") {
 			 	lastFocusedSet = element;
 			 } else {
 			 	 lastFocusedSet.className = "setsTableDataInput";
 			 	 lastFocusedSet = element;
 			 }
 			 lastFocusedSet.className = "setsTableDataInputFocused";
     	 }
     </script>
     <script>
     	 function doImport() {
     	 	var lastFocusedRow = lastFocusedSet.parentNode.parentNode;
 			 var setToImportId = lastFocusedRow.id;
 			 
 			 if(setToImportId != "") {
     	 	     var operationKey = "operation";
 
 				  var jsonObject  = {};
 			     jsonObject[operationKey] = "Import";
 			     		     
               var jsonStringParam = JSON.stringify(jsonObject);
               
               var programSelect = document.getElementById("programSelect");
               var selectedProgramIndex = programSelect.selectedIndex;
               var programId = programSelect.options[selectedProgramIndex].value;
 
               var fullPath = path.concat(programId, "/set/", setToImportId);
               
               put(fullPath, jsonStringParam, putSetStatusHandler, lastFocusedRow);			 		
 			 }		 
     	 }
     </script>
     <script>
     	 function doReport() {
     	        var programSelect = document.getElementById("programSelect");
     	        var selectedProgramIndex = programSelect.selectedIndex;
     	 		  var programId = programSelect.options[selectedProgramIndex].value;
     	        var fullPath = path.concat(programId, "/report/");
               post(fullPath, "", postReportStatusHandler, "");			 		
     	 }
     </script>
     <script>
        function doSetDelete() {
     	 	  var lastFocusedRow = lastFocusedSet.parentNode.parentNode;
 			  var setToImportId = lastFocusedRow.id;
 			 
 			 if(setToImportId != "") {
               var selectedProgramIndex = programSelect.selectedIndex;
               var programId = programSelect.options[selectedProgramIndex].value;
 
               var fullPath = path.concat(programId, "/set/", setToImportId);
               
               doDelete(fullPath, deleteSetStatusHandler, lastFocusedRow);		 
         	 }
       }
     </script>
     <script>
     function getPrograms() {
         if (programSelect.length < 2) {
             get(path, getAllProgramsStatusHandler, programSelect);
         }
     }
 </script>
 <script>
     function getProgramDetails(programSelect) {
         var selectedIndex = programSelect.selectedIndex;
         var programId = programSelect.options[selectedIndex].value;
 
         var fullPath = path.concat(programId, "/set/admin");
         get(fullPath, getProgramAdminStatusHandler, programSelect);
     }
 </script>
 <script>
       function populateReportSetSelects() {
           var selectedIndex = programSelect.selectedIndex;
           var programId = programSelect.options[selectedIndex].value;
 
           var fullPath = path.concat(programId, "/set/");
           get(fullPath, populateSetSelectsStatusHandler, "");
       }
   </script>
     <script>
         function namePromptClose() {
             var blanketEl = document.getElementById("blanket");
             blanketEl.removeChild(createSetDiv);
 				blanketEl.style.display = 'none';
             createSetDiv.style.display = 'none';
         }
     </script>
     <script>
         function bringUpNamePromptCreate() {
             var blanketEl = document.getElementById("blanket");
             blanketEl.appendChild(createSetDiv);
 				blanketEl.style.display = 'block';
             createSetDiv.style.display = 'block';
             
            var setName = document.getElementById("setNameInput");
     	 	  var setPath = document.getElementById("setPathInput");
     	 	  
     	 	  namePromptSumbit.setAttribute('onclick', 'setCreateSubmit()');
     	 	  
     	 	  var promptTitle = document.getElementById("promptTitle");
     	 	  promptTitle.innerHTML = "Create Set";
     	 	  setName.value = "";
     	 	  setPath.value = "";
         }
     </script>
     <script>
         function getSetForUpdate() {
            var lastFocusedRow = lastFocusedSet.parentNode.parentNode;
            var setId = lastFocusedRow.id;
 			  		     
 			  var selectedProgramIndex = programSelect.selectedIndex;
 			  var programId = programSelect.options[selectedProgramIndex].value;
 			
 			  var fullPath = path.concat(programId, "/set/", setId);
 			  
 			  get(fullPath, getSetStatusHandlerForUpdate, lastFocusedRow);		
         }
     </script>
     <script>
     	  function generateReport() {
     	  	   var setSelectPrimaryIndex = setSelectPrimary.selectedIndex;
     	  	   var setSelectPrimaryId = setSelectPrimary.options[setSelectPrimaryIndex].value;
     	  	   
     	  	   var setSelectSecondaryIndex = setSelectSecondary.selectedIndex;
     	  	   var setSelectSecondaryId = setSelectSecondary.options[setSelectSecondaryIndex].value;
     	  	   
     	  	   var selectedProgramIndex = programSelect.selectedIndex;
 			   var programId = programSelect.options[selectedProgramIndex].value;
     	  	   
     	  	   var fullPath = path.concat(programId, "/report?primarySet=", setSelectPrimaryId, "&secondarySet=", setSelectSecondaryId);
		   window.location.href = fullPath;
     	  }
     </script>
     <script>
         function bringUpNamePromptUpdate(setName, setPath, setRow) {
             var blanketEl = document.getElementById("blanket");
             blanketEl.appendChild(createSetDiv);
 				blanketEl.style.display = 'block';
             createSetDiv.style.display = 'block';
             
            var setNameInput = document.getElementById("setNameInput");
     	 	  var setPathInput = document.getElementById("setPathInput");
 
 			  var promptTitle = document.getElementById("promptTitle");
     	 	  promptTitle.innerHTML = "Edit Set";
     	 	  setNameInput.value = setName;
     	 	  setPathInput.value = setPath;
     	 	  
  	 	     namePromptSumbit.onclick = (function() {
 			      var setRowParam = setRow;
 			      var oldNameParam = setName; 
 			      var oldPathParam = setPath;
 			      return function() { 
 			          setUpdateSubmit(oldNameParam, oldPathParam, setRowParam);
 			      }
 			   })();
         }
     </script>
     <script>
     	 function setUpdateSubmit(oldName, oldPath, setRow) {
     	 	  var setName = document.getElementById("setNameInput").value;
     	 	  var setPath = document.getElementById("setPathInput").value;
     	 	  
     	 	  if(oldName == setName && oldPath == setPath) {
     	 	  		// do nothing
     	 	  }
     	 	  else {
     	 	  	  namePromptClose();
     	 	     var nameKey = "name";
     	 	     var pathKey = "importPath";
 
 				  var jsonObject  = {};
 				  if(oldName != setName) {
 			     	 jsonObject[nameKey] = setName;
 			     }
 			     if(oldPath != setPath) {
 			     	  jsonObject[pathKey] = setPath;	
 			     }
 			     		     
               var jsonStringParam = JSON.stringify(jsonObject);
               
               var programSelect = document.getElementById("programSelect");
               var selectedProgramIndex = programSelect.selectedIndex;
               var programId = programSelect.options[selectedProgramIndex].value;
 
               var fullPath = path.concat(programId, "/set/", setRow.id);
               
               put(fullPath, jsonStringParam, putSetStatusHandler, setRow);
     	 	  }
     	 }
     </script>
     <script>
     	 function setCreateSubmit() {
     	 	  var setName = document.getElementById("setNameInput").value;
     	 	  var setPath = document.getElementById("setPathInput").value;
     	 	  
     	 	  if(setName == "" || setPath == "") {
     	 	  		// do nothing
     	 	  }
     	 	  else {
     	 	  	  namePromptClose();
     	 	     var nameKey = "name";
     	 	     var pathKey = "importPath";
 
 				  var jsonObject  = {};
 			     jsonObject[nameKey] = setName;
 			     jsonObject[pathKey] = setPath;	
 			     		     
               var jsonStringParam = JSON.stringify(jsonObject);
               
               var programSelect = document.getElementById("programSelect");
               var selectedProgramIndex = programSelect.selectedIndex;
               var programId = programSelect.options[selectedProgramIndex].value;
 
               var fullPath = path.concat(programId, "/set/");
               
               post(fullPath, jsonStringParam, postSetStatusHandler, "");
     	 	  }
     	 }
     </script>
     <script>
     function getProgramAdminStatusHandler(setSelectEl) {
         return function() {
         		if(this.readyState == 1) {
         		     waitBlanket.style.display = 'block';
         		}
             if (this.readyState == 4) {
                 waitBlanket.style.display = 'none';
                 
                 var responseHTML = this.responseText;
                 var setsTableBody = document.getElementById("setsTableBody");
                 setsTableBody.innerHTML = responseHTML;
                 
                 // check to see if there are any sets, if so change the class from emptySetsTable
                 var setsTable = document.getElementById("setsTable");
                 if(setsTableBody.rows[0].id != "") {
                 	setsTable.className = "setsTable";
                 } else {
                   setsTable.className = "emptySetsTable";
                 }
                 
                 // Enable create set and import buttons
                 var setCreateButton = document.getElementById("setCreate");
                 setCreateButton.disabled=false;
                 var setOperationButton = document.getElementById("setOperation");
                 setOperationButton.disabled=false;
                 
                 populateReportSetSelects();
             }
         };
     }
 	</script>
     <script>
         function postSetStatusHandler(noParam) {
             return function() {
         		if(this.readyState == 1) {
         		     waitBlanket.style.display = 'block';
         		}            
              if (this.readyState == 4) {
                  waitBlanket.style.display = 'none';
                  
                 var setsTable = document.getElementById("setsTable");
                 setsTable.className = "setsTable";
                 
                 
              	  var setObject = eval('(' + this.responseText + ')');
              	  
                  var rows = setsTable.rows;
                  var index = 1;
                  var nextFreeRow = -1;
                  while(index < rows.length && nextFreeRow == -1) {
                  		var cell = rows[index].cells[0];
                  		if(cell.innerHTML == "") {
                  			nextFreeRow = index;
                  		} 
                  		index++;
                  }
                  
                  if(nextFreeRow == -1) {
              			var newRow = setsTable.insertRow(rows.length);
              			newRow.id = setObject.guid;
              			var nameCell = newRow.insertCell(0);
 							var summaryCell = newRow.insertCell(1);
 							
 							var nameInput = document.createElement("input");
 							nameInput.className = "setsTableDataInput";
 							nameInput.value = setObject.name;
 	          			nameInput.setAttribute('onclick', 'setFocused(this)');
 							nameCell.appendChild(nameInput);
 							nameCell.className = "setsTableData";
 							
 							summaryCell.innerHTML = "No Import";	// change to summary field
 							summaryCell.className = "setsTableData";
 							
 							setFocused(nameInput);
 							
                  } else {
                  	  var nameInput = document.createElement("input");
                  	  nameInput.value = setObject.name;
                  	  nameInput.className = "setsTableDataInput";
                  	  nameInput.setAttribute('onclick', 'setFocused(this)');
 	                 rows[nextFreeRow].cells[0].appendChild(nameInput);
 	                 rows[nextFreeRow].cells[1].innerHTML = "No Import";
 	                 rows[nextFreeRow].id = setObject.guid;
 	                 setFocused(nameInput);
 	              }
              }
          };
         }
     </script>
     <script>
     function postReportStatusHandler(unusedParam) {
     	return function() {
     		
     	}
     }
     </script>
 <script>
 	function putSetStatusHandler(setRow) {
 		return function() {
 				var selectedInput = setRow.cells[0].firstChild;
 		      if(this.readyState == 1) {
 						selectedInput.className = "setsTableDataInputImporting";
 						selectedInput.setAttribute('onclick', '');
 						setRow.cells[1].innerHTML = "...WORKING...";
         		} 
         		if(this.readyState == 4) {	
         			 selectedInput.className = "setsTableDataInput";
         			 selectedInput.setAttribute('onclick', 'setFocused(this)');
 					 getSet(setRow);
         		} 
         		if(this.readyState == 4 && this.status != 200) {
         			 setRow.cells[1].innerHTML = "Error Importing.";
         		}
         	};
 	}
 </script>
     <script>
     		function getSet(setRow) {
     		     var programSelect = document.getElementById("programSelect");
               var selectedProgramIndex = programSelect.selectedIndex;
               var programId = programSelect.options[selectedProgramIndex].value;
 
               var fullPath = path.concat(programId, "/set/", setRow.id);
               
               get(fullPath, getSetStatusHandler, setRow);
     		}
     </script>
     
     <script>
 	    function getSetStatusHandler(setRow) {
 	        return function() {
 	            if (this.readyState == 4 && this.status==200) {
 	                var setObject = eval('(' + this.responseText + ')');
 	                setRow.cells[0].firstChild.value = setObject.name;
 	                setRow.cells[1].innerHTML = "No Summary Available";
 	            }
 	        };
 	    }
 	</script>
 	<script>
 		 function populateSetSelectsStatusHandler(emptyParam) {
 		 	  return function() {
 	            if (this.readyState == 4) {
 	                var responseHTML = this.responseText;
 	                setSelectPrimary.innerHTML = responseHTML;
 	                setSelectSecondary.innerHTML = responseHTML;
 	            }
 		 	  }
 		 }
 	</script>
 	<script>
 	    function getSetStatusHandlerForUpdate(setRow) {
 	        return function() {
 	            if (this.readyState == 4 && this.status==200) {
 	                var setObject = eval('(' + this.responseText + ')');
 	                
 	                bringUpNamePromptUpdate(setObject.name, setObject.importPath, setRow);
 	            }
 	        };
 	    }
 	</script>
    <script>
     function getAllProgramsStatusHandler(unusedParam) {
         return function() {
             if (this.readyState == 4) {
                 var responseHTML = this.responseText;
                 programSelect.innerHTML = responseHTML;
             }
         };
     }
 </script>
    <script>
     function deleteSetStatusHandler(deletedRow) {
         return function() {
             if (this.readyState == 4) {
                 var rowIndex = deletedRow.sectionRowIndex;
                 var setsTableBody = document.getElementById("setsTableBody");
                 setsTableBody.deleteRow(rowIndex);
                 
                 var rowsCount = setsTableBody.rows.length;
                 if(rowsCount < 7) {
                 	 var newRow = setsTableBody.insertRow(rowsCount-1);
                 	 var newCell1 =  newRow.insertCell(0);
                 	 var newCell2 = newRow.insertCell(1);
                 	 
                 	 newCell1.className = "setsTableData";
                 	 newCell2.className = "setsTableData";
                 }
             }
         };
     }
 </script>
 <script>
 	 function getGenerateReportStatusHandler(unusedParam) {
 	 	 return function() {
 	 	     if (this.readyState == 4) {
 	 	 			window.location.href = this.responseXML.URL;
 	 	 		}
 	 	 }
 	 }
 </script>
 <script>
     function put(url, params, statusHandler, callbackParam) {
         httpRequestWithParams("PUT", url, params, statusHandler, callbackParam);
     }
 </script>
     <script>
     function get(url, statusHandler, callbackParam) {
         httpRequest("GET", url, statusHandler, callbackParam);
     }
 </script>
     <script>
         function post(url, params, statusHandler, callbackParam) {
             httpRequestWithParams("POST", url, params, statusHandler, callbackParam);
         }
     </script>
      <script>
          function doDelete(url, statusHandler, callbackParam) {
              httpRequest("DELETE", url, statusHandler, callbackParam);
          }
      </script>
     <script>
         function httpRequestWithParams(httpVerb, url, params, statusHandler, callbackParam) {
             var httpRequest = new XMLHttpRequest()
             httpRequest.prevDataLength = 0;
             httpRequest.onreadystatechange = statusHandler(callbackParam);
             httpRequest.open(httpVerb, url);
             //Send the proper header information along with the request
             httpRequest.setRequestHeader("Content-type", "application/json");
 
             httpRequest.send(params);
         }
     </script>
     <script>
     function httpRequest(httpVerb, url, statusHandler, callbackParam) {
         var httpRequest = new XMLHttpRequest()
         httpRequest.prevDataLength = 0;
         httpRequest.onreadystatechange = statusHandler(callbackParam);
         httpRequest.open(httpVerb, url);
         httpRequest.send();
     }
 </script>
     
 </body>
